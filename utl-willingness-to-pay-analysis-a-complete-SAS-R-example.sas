Willingness to pay analysis a complete SAS R example

github
https://tinyurl.com/y7jcqy9h
https://github.com/rogerjdeangelis/utl-willingness-to-pay-analysis-a-complete-SAS-R-example

SAS Forum
https://tinyurl.com/y98dux6p
https://communities.sas.com/t5/Statistical-Procedures/find-out-willingness-to-pay/m-p/519152

You can run this with SAS/IML/R

I am out of my comfort zonw with willingness to pay, but here is a complete
example with an interface to SAS.

SOAPBOX ON

  There are two properties of data objects in R that R would be better without
   1. Rownames
   2, Factor Type (this was done to save space (assings numbers to char string AUTOMATICALLY))

   Not to mention the other five datatypes and myriad of data structures?

   Getting data in and out of R (and Python?) is a nightmare. Less is more

   I do see the value the list data structure, but use it sparingly?

SOAPBOX OFF


INPUT
=====

SD1.HAVE total obs=532

 ID  CHOICE  PF1  PF2  PF3  PF4  CL1  CL2  CL3  CL4  LOC1  LOC2  LOC3  LOC4  WK1  WK2  WK3  WK4  TOD1  TOD2  TOD3  TOD4  SEAS1  SEAS2  SEAS3  SEAS4

  8     2     2    9    0    0    7    0    0    1     5     0     0     1    0    0    1    0     1     0     0     1     0      0      1      0
  8     2     2    0    7    0    9    0    5    0     1     0     0     1    0    0    0    0     1     1     0     0     0      0      0      1
  8     2     2    0    9    0    7    1    5    5     0     0     0     0    0    0    1    1     0     1     0     0     0      0      0      1
  8     2     2    9    7    0    0    0    5    1     1     1     0     0    0    0    0    1     0     0     0     0     1      0      0      1
  8     2     2    0    7    9    0    0    1    5     5     1     0     0    0    0    0    1     1     1     0     0     0      0      0      0
  8     3     3    9    0    7    0    5    0    1     0     0     0     0    1    1    0    0     0     0     0     0     1      0      1      0
  8     1     1    7    0    0    9    0    0    5     1     0     0     0    0    0    1    1     0     0     1     0     0      0      0      1
  8     1     1    7    0    0    9    5    1    5     0     1     0     0    0    0    0    0     1     0     0     1     0      0      1      0
  8     4     4    0    0    9    7    0    1    0     5     0     0     0    1    1    0    1     0     0     1     0     0      1      0      0
  8     4     4    0    0    9    7    5    1    5     0     0     0     1    0    0    0    0     1     0     1     0     0      1      0      0
  8     4     4    9    0    0    7    5    0    5     1     0     0     1    0    1    1    0     0     0     1     0     0      0      0      1
  8     2     2    9    7    0    0    1    0    5     0     0     1     0    0    1    0    1     0     0     0     1     0      0      0      0


EXAMPLE OUTPUT
--------------

 WORK.LST. Printed output in a SAS datasets LST.sas7bdat

  Obs                                 LST
    1
    2    Willigness-to-pay respect to:  PF
    3
    4         Estimate Std. Error t-value  Pr(>|t|)
    5    CL    0.12059    0.22783  0.5293    0.5966
    6    LOC  -0.14996    0.44008 -0.3408    0.7333
    7    WK    1.58923    1.49195  1.0652    0.2868
    8    TOD   7.52268    1.52802  4.9232 8.516e-07 ***
    9    SEAS  8.64139    1.67031  5.1735 2.297e-07 ***
   10    ---
   11    Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 WORK.WANT total obs=5

             STD__
  CATS  ESTIMATE     ERROR      T_VALUE    PR___T__

  CL     0.12059    0.22783     0.52929     0.59661
  LOC   -0.14996    0.44008    -0.34075     0.73329
  WK     1.58923    1.49195     1.06520     0.28679
  TOD    7.52268    1.52802     4.92317     0.00000
  SEAS   8.64139    1.67031     5.17353     0.00000


PROCESS
=======

%utl_submit_r64('
library(SASxport);
library(mlogit);
library(haven);
library(msm);
library(gmnl);
 have<-read_sas("d:/sd1/have.sas7bdat");
 Electr <- mlogit.data(have, id.var = "ID", choice = "CHOICE",varying = 3:26, shape = "wide", sep = "");
 clogit <- gmnl(CHOICE ~ PF + CL + LOC + WK + TOD + SEAS| 0,data = Electr);
 lst<-as.data.frame(capture.output(wtp.gmnl(clogit, wrt = "PF")));
 lst[] <- lapply(lst, function(x) if(is.factor(x)) as.character(x) else x);
 str(lst);
 want<-as.data.frame(wtp.gmnl(clogit, wrt = "PF"));
 want$cat <- rownames(want);
 write.xport(lst,want,file="d:/xpt/lstWant.xpt");
');

libname xpt xport "d:/xpt/lstWant.xpt";

data want;
  set xpt.want;
run;quit;

data lst;
  set xpt.lst;
run;quit;

*                _               _       _
 _ __ ___   __ _| | _____     __| | __ _| |_ __ _
| '_ ` _ \ / _` | |/ / _ \   / _` |/ _` | __/ _` |
| | | | | | (_| |   <  __/  | (_| | (_| | || (_| |
|_| |_| |_|\__,_|_|\_\___|   \__,_|\__,_|\__\__,_|

;

options validvarname=upcase;
libname sd1 "d:/sd1";
data sd1.have;
 input  (ID CHOICE PF1 PF2 PF3 PF4 CL1 CL2 CL3 CL4 LOC1 LOC2 LOC3 LOC4 WK1 WK2 WK3 WK4 TOD1 TOD2 TOD3 TOD4 SEAS1 SEAS2 SEAS3 SEAS4) (3. 26*1.) @;output;
 input  @31 (ID CHOICE PF1 PF2 PF3 PF4 CL1 CL2 CL3 CL4 LOC1 LOC2 LOC3 LOC4 WK1 WK2 WK3 WK4 TOD1 TOD2 TOD3 TOD4 SEAS1 SEAS2 SEAS3 SEAS4) (3. 26*1.) @;output;
 input  @61 (ID CHOICE PF1 PF2 PF3 PF4 CL1 CL2 CL3 CL4 LOC1 LOC2 LOC3 LOC4 WK1 WK2 WK3 WK4 TOD1 TOD2 TOD3 TOD4 SEAS1 SEAS2 SEAS3 SEAS4) (3. 26*1.) @;output;
 input  @91 (ID CHOICE PF1 PF2 PF3 PF4 CL1 CL2 CL3 CL4 LOC1 LOC2 LOC3 LOC4 WK1 WK2 WK3 WK4 TOD1 TOD2 TOD3 TOD4 SEAS1 SEAS2 SEAS3 SEAS4) (3. 26*1.);output;
cards4;
00822900700150010010100100100 00822070905010010000110000010 00822090715500000011010000010 00822970005111000001000010010
00822079001551000001110000001 00833907050100001100000010100 00811700900510000011001000010 00811700951501000000100100100
00844009701050001101001001000 00844009751500010000101001000 00844900750510010110001000010 00822970010500100101000100001
01633090750150100101010000010 01622070951011000000000101000 01644070015010000010010100001 01633970000150001101000010010
01622700951001000010000100100 01633009755100010100110000100 01611079010050010000100011000 01622970011051000011000100001
01633070950100100001010000010 01622070951011000010000101000 01622790010510001010000100001 01633970000150001101000010010
02422900750150010010100100100 02411009705510000100101001000 02433090715500100101010000010 02422900701150000101000100100
02444009750110000001101001000 02433700951010000011001000010 02444907051500001001001000001 02444970050010000001100100001
02422097001550100100100011000 02444709005110010110001000001 02444097051001000010110000001 02433097015010010110110000001
03233900750150010010100100100 03211009705510000100101001000 03211090715500100101010000010 03233900701150000101000100100
03244009750110000001101001000 03244700951010000011001000010 03233907051500001001001000001 03244970050010000001100100001
03222097001550100100100011000 03233709005110010110001000001 03222097051001000010110000001 03222097015010010110110000001
04011700951001000010000100100 04033009755100010100110000100 04033079010050010000100011000 04022970011051000011000100001
04022070950100100001010000010 04011070951011000010000101000 04022790010510001010000100001 04011970000150001101000010010
04011009901151000000101001000 04011970005100010100000010010 04044090710050001110000101000 04011097050100000110000011000
04833700951001000010000100100 04844009755100010100110000100 04822079010050010000100011000 04833970011051000011000100001
04822070950100100001010000010 04833070951011000010000101000 04811790010510001010000100001 04822970000150001101000010010
04822009901151000000101001000 04844970005100010100000010010 04833090710050001110000101000 04844097050100000110000011000
05622900750150010010100100100 05644009705510000100101001000 05611090715500100101010000010 05622900701150000101000100100
05622009750110000001101001000 05633700951010000011001000010 05633907051500001001001000001 05633970050010000001100100001
05644097001550100100100011000 05622709005110010110001000001 05622097051001000010110000001 05644097015010010110110000001
06422090750150100101010000010 06411070951011000000000101000 06422070015010000010010100001 06411970000150001101000010010
06411700951001000010000100100 06433009755100010100110000100 06433079010050010000100011000 06411970011051000011000100001
06422070950100100001010000010 06411070951011000010000101000 06444790010510001010000100001 06411970000150001101000010010
07233079001551000001110000001 07211907050100001100000010100 07233700900510000011001000010 07211700951501000000100100100
07244009701050001101001001000 07244009751500010000101001000 07211900750510010110001000010 07233970010500100101000100001
07244090001550000000110000011 07211907055100000100000010100 07233700910550010000101000010 07222007901500000010010000100
08011700951001000010000100100 08044009755100010100110000100 08022079010050010000100011000 08022970011051000011000100001
08022070950100100001010000010 08022070951011000010000101000 08011790010510001010000100001 08022970000150001101000010010
08011009901151000000101001000 08033970005100010100000010010 08044090710050001110000101000 08033097050100000110000011000
08811700951001000010000100100 08833009755100010100110000100 08833079010050010000100011000 08811970011051000011000100001
08822070950100100001010000010 08833070951011000010000101000 08844790010510001010000100001 08833970000150001101000010010
08811009901151000000101001000 08833970005100010100000010010 08811090710050001110000101000 08822097050100000110000011000
09622090750150100101010000010 09622070951011000000000101000 09622070015010000010010100001 09611970000150001101000010010
09611700951001000010000100100 09644009755100010100110000100 09633079010050010000100011000 09622970011051000011000100001
09622070950100100001010000010 09622070951011000010000101000 09622790010510001010000100001 09622970000150001101000010010
10411700951001000010000100100 10444009755100010100110000100 10433079010050010000100011000 10422970011051000011000100001
10422070950100100001010000010 10422070951011000010000101000 10422790010510001010000100001 10411970000150001101000010010
10444009901151000000101001000 10411970005100010100000010010 10444090710050001110000101000 10422097050100000110000011000
11233900750150010010100100100 11244009705510000100101001000 11211090715500100101010000010 11222900701150000101000100100
11222009750110000001101001000 11233700951010000011001000010 11244907051500001001001000001 11233970050010000001100100001
11211097001550100100100011000 11244709005110010110001000001 11211097051001000010110000001 11233097015010010110110000001
12011970051050000100000000011 12044009715500110100110000100 12022079010050000100100011000 12033907015051000010101000001
12044900750150010010100100100 12044009705510000100101001000 12022090715500100101010000010 12011900701150000101000100100
12044009750110000001101001000 12044700951010000011001000010 12033907051500001001001000001 12022970050010000001100100001
12811970051050000100000000011 12844009715500110100110000100 12833079010050000100100011000 12811907015051000010101000001
12844900750150010010100100100 12811009705510000100101001000 12822090715500100101010000010 12811900701150000101000100100
12844009750110000001101001000 12833700951010000011001000010 12844907051500001001001000001 12844970050010000001100100001
13633070905111000010100101000 13633700951050001011001000010 13633907011500001001001000001 13633790051010001101000100001
13644790051050100100100010010 13633790005150010110000100001 13633970051000001011000100001 13611097011050010100100011000
13611090701051000010110000010 13633090700150010000100101000 13633090750150001100000101000 13633970001150010100000010010
14433900700150010010100100100 14444070905010010000110000010 14411090715500000011010000010 14411970005111000001000010010
14422079001551000001110000001 14433907050100001100000010100 14411700900510000011001000010 14411700951501000000100100100
14444009701050001101001001000 14433009751500010000101001000 14433900750510010110001000010 14422970010500100101000100001
15211700951001000010000100100 15244009755100010100110000100 15222079010050010000100011000 15222970011051000011000100001
15222070950100100001010000010 15222070951011000010000101000 15211790010510001010000100001 15222970000150001101000010010
15233009901151000000101001000 15222970005100010100000010010 15244090710050001110000101000 15233097050100000110000011000
16011079001551000001110000001 16044907050100001100000010100 16011700900510000011001000010 16044700951501000000100100100
16033009701050001101001001000 16044009751500010000101001000 16022900750510010110001000010 16022970010500100101000100001
16044090001550000000110000011 16044907055100000100000010100 16022700910550010000101000010 16022007901500000010010000100
16822700951001000010000100100 16844009755100010100110000100 16833079010050010000100011000 16822970011051000011000100001
16822070950100100001010000010 16811070951011000010000101000 16844790010510001010000100001 16833970000150001101000010010
16811009901151000000101001000 16833970005100010100000010010 16811090710050001110000101000 16811097050100000110000011000
17633900700150010010100100100 17633070905010010000110000010 17611090715500000011010000010 17644970005111000001000010010
17611079001551000001110000001 17633907050100001100000010100 17611700900510000011001000010 17622009701050001101001001000
17644009751500010000101001000 17644900750510010110001000010 17622970010500100101000100001 18433090750150100101010000010
18433070951011000000000101000 18444070015010000010010100001 18411970000150001101000010010 18411700951001000010000100100
18444009755100010100110000100 18433079010050010000100011000 18444970011051000011000100001 18422070950100100001010000010
18422070951011000010000101000 18411790010510001010000100001 18422970000150001101000010010 19233700951001000010000100100
19244009755100010100110000100 19211079010050010000100011000 19233970011051000011000100001 19222070950100100001010000010
19233070951011000010000101000 19211790010510001010000100001 19222970000150001101000010010 19222009901151000000101001000
19244970005100010100000010010 19233090710050001110000101000 19244097050100000110000011000 20011700951001000010000100100
20033009755100010100110000100 20033079010050010000100011000 20011970011051000011000100001 20022070950100100001010000010
20033070951011000010000101000 20011790010510001010000100001 20044970000150001101000010010 20011009901151000000101001000
20033970005100010100000010010 20044090710050001110000101000 20033097050100000110000011000 20811079001551000001110000001
20844907050100001100000010100 20822700900510000011001000010 20822700951501000000100100100 20811009701050001101001001000
20844009751500010000101001000 20822900750510010110001000010 20822970010500100101000100001 20844090001550000000110000011
20844907055100000100000010100 20833700910550010000101000010 20822007901500000010010000100 21622970051050000100000000011
21644009715500110100110000100 21622079010050000100100011000 21633907015051000010101000001 21644900750150010010100100100
21644009705510000100101001000 21644090715500100101010000010 21644900701150000101000100100 21644009750110000001101001000
21611700951010000011001000010 21633907051500001001001000001 21622970050010000001100100001 22422079010050000100100011000
22411907015051000010101000001 22422009705510000100101001000 22422090715500100101010000010 22411900701150000101000100100
22444009750110000001101001000 22433907051500001001001000001 22444970050010000001100100001 23222970051050000100000000011
23244009715500110100110000100 23222079010050000100100011000 23233907015051000010101000001 23244900750150010010100100100
23244009705510000100101001000 23244090715500100101010000010 23211900701150000101000100100 23244009750110000001101001000
23244700951010000011001000010 23233907051500001001001000001 23222970050010000001100100001 24033900700150010010100100100
24011070905010010000110000010 24011090715500000011010000010 24044970005111000001000010010 24011079001551000001110000001
24044907050100001100000010100 24022700900510000011001000010 24033700951501000000100100100 24022009701050001101001001000
24022009751500010000101001000 24022900750510010110001000010 24033970010500100101000100001 24833970051050000100000000011
24811009715500110100110000100 24811079010050000100100011000 24844907015051000010101000001 24822900750150010010100100100
24811009705510000100101001000 24833090715500100101010000010 24811900701150000101000100100 24844009750110000001101001000
24833700951010000011001000010 24844907051500001001001000001 24844970050010000001100100001 25644900700150010010100100100
25622070905010010000110000010 25644090715500000011010000010 25633970005111000001000010010 25622079001551000001110000001
25633907050100001100000010100 25611700900510000011001000010 25622700951501000000100100100 25611009701050001101001001000
25644009751500010000101001000 25644900750510010110001000010 25622970010500100101000100001 26411970051050000100000000011
26411009715500110100110000100 26444079010050000100100011000 26411907015051000010101000001 26433900750150010010100100100
26444009705510000100101001000 26444090715500100101010000010 26433900701150000101000100100 26444009750110000001101001000
26422700951010000011001000010 26422907051500001001001000001 26422970050010000001100100001 27211090750150100101010000010
27211070951011000000000101000 27222070015010000010010100001 27211970000150001101000010010 27211700951001000010000100100
27233009755100010100110000100 27233079010050010000100011000 27211970011051000011000100001 27222070950100100001010000010
27222070951011000010000101000 27222790010510001010000100001 27211970000150001101000010010 28011700951001000010000100100
28044009755100010100110000100 28044079010050010000100011000 28022970011051000011000100001 28022070950100100001010000010
28022070951011000010000101000 28011790010510001010000100001 28022970000150001101000010010 28022009901151000000101001000
28044970005100010100000010010 28044090710050001110000101000 28033097050100000110000011000 28811079001551000001110000001
28844907050100001100000010100 28822700900510000011001000010 28811700951501000000100100100 28844009701050001101001001000
28833009751500010000101001000 28833900750510010110001000010 28822970010500100101000100001 28844090001550000000110000011
28844907055100000100000010100 28833700910550010000101000010 28833007901500000010010000100 29611700951001000010000100100
29611009755100010100110000100 29644079010050010000100011000 29644970011051000011000100001 29611070950100100001010000010
29611070951011000010000101000 29633790010510001010000100001 29644970000150001101000010010 29644009901151000000101001000
29611970005100010100000010010 29644090710050001110000101000 29611097050100000110000011000 30444900700150010010100100100
30444070905010010000110000010 30433090715500000011010000010 30411970005111000001000010010 30433079001551000001110000001
30411907050100001100000010100 30411700900510000011001000010 30411700951501000000100100100 30444009701050001101001001000
30433009751500010000101001000 30433900750510010110001000010 30422970010500100101000100001 31222090750150100101010000010
31222070951011000000000101000 31222070015010000010010100001 31211970000150001101000010010 31211700951001000010000100100
31244009755100010100110000100 31233079010050010000100011000 31222970011051000011000100001 31222070950100100001010000010
31222070951011000010000101000 31211790010510001010000100001 32011090750150100101010000010 32033070951011000000000101000
32022070015010000010010100001 32044970000150001101000010010 32011700951001000010000100100 32033009755100010100110000100
32033079010050010000100011000 32011970011051000011000100001 32022070950100100001010000010 32022070951011000010000101000
32022790010510001010000100001 32011970000150001101000010010 32844900700150010010100100100 32844070905010010000110000010
32811090715500000011010000010 32822970005111000001000010010 32822079001551000001110000001 32844907050100001100000010100
32822700900510000011001000010 32811700951501000000100100100 32844009701050001101001001000 32844009751500010000101001000
32844900750510010110001000010 32822970010500100101000100001 33644070905111000010100101000 33622700951050001011001000010
33644907011500001001001000001 33644790051010001101000100001 33622790051050100100100010010 33633790005150010110000100001
33644970051000001011000100001 33633097011050010100100011000 33611090701051000010110000010 33633090700150010000100101000
33644090750150001100000101000 33633970001150010100000010010 34433700951001000010000100100 34411009755100010100110000100
34444079010050010000100011000 34433970011051000011000100001 34422070950100100001010000010 34433070951011000010000101000
34422790010510001010000100001 34444970000150001101000010010 34422009901151000000101001000 34411970005100010100000010010
34433090710050001110000101000 34444097050100000110000011000 35211079001551000001110000001 35222907050100001100000010100
35222700900510000011001000010 35244700951501000000100100100 35233009701050001101001001000 35244009751500010000101001000
35222900750510010110001000010 35244970010500100101000100001 35211090001550000000110000011 35244907055100000100000010100
35222700910550010000101000010 35211007901500000010010000100 36011907011500001001001000001 36022790051010001101000100001
36022790051050100100100010010 36011790005150010110000100001 36022970051000001011000100001 36033097011050010100100011000
36022090701051000010110000010 36022090700150010000100101000 36022090750150001100000101000 36011970001150010100000010010
;;;;
run;quit;

